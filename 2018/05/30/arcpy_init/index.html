<!DOCTYPE html>
<html>
  <!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  
  <title>arcpy数据结构测试记录 - 双犬科技基站</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
  
  <meta name="keywords" content=GIS,Python>
  
    <meta name="description" content="personal blog">
  
  
    <link rel="shortcut icon" type="image/x-icon" href="/sq.png?v=1.02">
  
  
    <link rel="alternate" href="/atom.xml " title="双犬科技基站" type="application/atom+xml">
  

  <link rel="stylesheet" href="/css/style.css">
</head>
  <body>
    <div class="container">
      <header class="header">
  <div class="blog-title">
    <a href="/" class="logo">双犬科技基站</a>
  </div>
  <nav class="navbar">
    <ul class="menu">
      
        <li class="menu-item">
          <a href="/" class="menu-item-link">首页</a>
        </li>
      
        <li class="menu-item">
          <a href="/archives" class="menu-item-link">归档</a>
        </li>
      
        <li class="menu-item">
          <a href="/about" class="menu-item-link">关于</a>
        </li>
      
    </ul>
  </nav>
</header>
<article class="post">
  <div class="post-title">
    <h1 class="article-title">arcpy数据结构测试记录</h1>
  </div>
   <div class="post-meta">
    <span class="post-time">2018-05-30</span>
  </div>
  <div class="post-content">
    <p><span class="pageTitle">0.</span></p>
<p>用arcpy读取点线面的转折点坐标。这是批量化处理数据的根本。</p>
<p>基本思路：通过游标来定位文件，进而读取数据。</p>
<p>游标可以做到：读取、新增/删除、编辑。</p>
<p>需要结合row子对象共同完成（cursor对象包含对row的操作函数——而不对表格直接处理，故先将记录转化为row对象用于操作）</p>
<p>操作思路：读取要素文件 –&gt; 布置游标 –&gt; row对象实例化 –&gt; (通过令牌等)输出row内数据</p>
<div class="blogPic"><br>    <img src="https://squanblog.oss-cn-hongkong.aliyuncs.com/arcpy_init/all.png?x-oss-process=image/resize,h_480" alt="基本几何类型——点、线、面"><br></div>

<p><span class="pageTitle">1.</span></p>
<p>首先要明白点的数据结构，明白它是按照怎样的逻辑进行组织的。(当要用到投影坐标系的时候可以用WGS 1984 World Mercator，如果要使用其他空间参考，可以用arcpy.ListSpatialReference函数进行搜索)</p>
<figure class="highlight python"><figcaption><span>输出name字段属性值</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> arcpy</span><br><span class="line">cur = arcpy.da.SearchCursor(<span class="string">'gdb/pt'</span>, [<span class="string">'NAME'</span>], spatial_reference=arcpy.SpatialReference(<span class="string">'WGS 1984'</span>))</span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> cur:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'name: '</span> + row[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 以下为输出结果</span></span><br><span class="line">name: test-c</span><br><span class="line">name: test-d</span><br><span class="line">name: test-e</span><br><span class="line">name: test-f</span><br></pre></td></tr></table></figure>
<p>通过cur游标定位到文件，之后就可以用row的实例化对象来操作记录。</p>
<p>但是可以看到，这里是没有几何信息的。想要读取坐标位置，还需要另外的方法。</p>
<p>从ArcGIS文档里可以看到我们需要的是SHAPE令牌。把SHAPE令牌加到布置的游标当中，生成的row实例就会包含几何信息。</p>
<figure class="highlight python"><figcaption><span>输出几何形状对象</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cur = arcpy.da.SearchCursor(<span class="string">'gdb/pt'</span>, [<span class="string">'NAME'</span>, <span class="string">'SHAPE@'</span>], spatial_reference=arcpy.SpatialReference(<span class="string">'WGS 1984'</span>))</span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> cur:</span><br><span class="line">    <span class="keyword">print</span> row[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 以下为输出结果</span></span><br><span class="line">&lt;geoprocessing describe geometry object object at <span class="number">0x0000000</span>&gt;</span><br><span class="line">&lt;geoprocessing describe geometry object object at <span class="number">0x0000000</span>&gt;</span><br><span class="line">&lt;geoprocessing describe geometry object object at <span class="number">0x0000000</span>&gt;</span><br><span class="line">&lt;geoprocessing describe geometry object object at <span class="number">0x0000000</span>&gt;</span><br></pre></td></tr></table></figure>
<p>理所当然地返回了几何对象类(其实是属性表里的 SHAPE* 列，返回值的情况与令牌类型有关)。之后通过对几何对象的属性读取，就可以输出坐标位置了。</p>
<figure class="highlight python"><figcaption><span>解析几何点的坐标</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cur = arcpy.da.SearchCursor(<span class="string">'gdb/pt'</span>, [<span class="string">'NAME'</span>, <span class="string">'SHAPE@'</span>], spatial_reference=arcpy.SpatialReference(<span class="string">'WGS 1984'</span>))</span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> cur:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'name: '</span> + row[<span class="number">0</span>] + <span class="string">'\tlng: '</span> + str(row[<span class="number">1</span>][<span class="number">0</span>].X) + <span class="string">',\tlat: '</span> + str(row[<span class="number">1</span>][<span class="number">0</span>].Y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 以下为输出结果</span></span><br><span class="line">name: t-c   	lng:<span class="number">121.23</span>,  lat:<span class="number">31.02</span></span><br><span class="line">name: t-d   	lng:<span class="number">121.24</span>,  lat:<span class="number">31.03</span></span><br><span class="line">name: t-e   	lng:<span class="number">121.25</span>,  lat:<span class="number">31.04</span></span><br><span class="line">name: t-f   	lng:<span class="number">121.26</span>,  lat:<span class="number">31.05</span></span><br></pre></td></tr></table></figure>
<p>读取坐标只是第一步，修改乃至增减记录才是最后的目标。这个时候需要用到不一样的工具，但是思路还是相同。</p>
<figure class="highlight python"><figcaption><span>更新name字段属性</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cur = arcpy.da.SearchCursor(<span class="string">'gdb/pt'</span>, [<span class="string">'NAME'</span>, <span class="string">'SHAPE@'</span>], spatial_reference=arcpy.SpatialReference(<span class="string">'WGS 1984'</span>))</span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> cur:</span><br><span class="line">    row[<span class="number">0</span>] = <span class="string">'update'</span> + row[<span class="number">0</span>]</span><br><span class="line">    cur.updateRow(row)</span><br></pre></td></tr></table></figure>
<p>通过以上内容，即可在每个点的名称前加上update前缀。    这是对普通记录的修改，对于坐标位置的修改需要构造相应的几何要素类(与令牌的类型有关，当使用SHAPE@XY时就不需要构造要素类)。</p>
<figure class="highlight python"><figcaption><span>更新点的位置</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> arcpy</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">inputFeature = <span class="string">'gdb/pt'</span></span><br><span class="line">cursor = arcpy.da.UpdateCursor(inputFeature, [<span class="string">'NAME'</span>, <span class="string">'SHAPE@'</span>], spatial_reference=arcpy.SpatialReference(<span class="string">'WGS 1984'</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> cursor:</span><br><span class="line">	<span class="keyword">for</span> pnt <span class="keyword">in</span> row[<span class="number">1</span>]:</span><br><span class="line">		point = arcpy.Point(pnt.X + random.random() - <span class="number">0.5</span>, pnt.Y + random.random() - <span class="number">0.5</span>)</span><br><span class="line">	row[<span class="number">1</span>] = point</span><br><span class="line">	cursor.updateRow(row)</span><br></pre></td></tr></table></figure>
<p>由此可以看到点要素明显的发生变化。具体的变化算法当然是随机应变。</p>
<div class="blogPic"><br>    <img src="https://squanblog.oss-cn-hongkong.aliyuncs.com/arcpy_init/point.png?x-oss-process=image/resize,h_480" alt="点要素的几何修改变动对比"><br></div>

<p><span class="pageTitle">2.</span></p>
<p>线和点的区别仅仅在于数据结构有所不同，放到抽象思路的层面，其实逻辑是相同的。</p>
<p>对于线而言，一条线段由两个或以上的端点组成，因此会多出一层描述不同线段的结构层，否则是无法区分哪个端点对应哪条线，也无法确定线段的几何形状的。</p>
<div class="blogPic"><br>    <img src="https://squanblog.oss-cn-hongkong.aliyuncs.com/arcpy_init/pl.jpg?x-oss-process=image/resize,h_200" alt="线要素的数据结构示意"><br></div>

<figure class="highlight"><figcaption><span>解析线要素的转折点坐标</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> arcpy</span><br><span class="line"></span><br><span class="line">inputFeature = <span class="string">'gdb/pl'</span></span><br><span class="line">cursor = arcpy.da.SearchCursor(inputFeature, [<span class="string">'NAME'</span>, <span class="string">'SHAPE@'</span>], spatial_reference=arcpy.SpatialReference(<span class="string">'WGS 1984'</span>))</span><br><span class="line"></span><br><span class="line">i1 = <span class="number">0</span></span><br><span class="line">i2 = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> cursor:</span><br><span class="line">	i1 += <span class="number">1</span></span><br><span class="line">	<span class="comment"># 会存在多部件的线要素——线要素中的每一条记录不一定只对应一条线</span></span><br><span class="line">	<span class="keyword">print</span> <span class="string">'current record index: '</span> + str(i1)</span><br><span class="line">	<span class="keyword">for</span> part <span class="keyword">in</span> row[<span class="number">1</span>]:</span><br><span class="line">		i2 += <span class="number">1</span></span><br><span class="line">		<span class="comment"># 对大部分(非绝对)线要素而言, len(part) = 1, 代表此行记录仅一条线, 在人工录入时尤其如此</span></span><br><span class="line">		<span class="keyword">print</span> <span class="string">'-&gt; current part index: '</span> + str(i2)</span><br><span class="line">		<span class="keyword">for</span> pnt <span class="keyword">in</span> part:</span><br><span class="line">			<span class="keyword">print</span> <span class="string">'---&gt; lng: '</span> + str(pnt.X) + <span class="string">'\tlat: '</span> + str(pnt.Y)</span><br><span class="line">	i2 = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 以下为输出结果</span></span><br><span class="line">current record index: <span class="number">1</span></span><br><span class="line">-&gt; current part index: 1</span><br><span class="line">---&gt; lng: 121.20684280	lat: 30.78693110</span><br><span class="line">---&gt; lng: 121.24784608	lat: 30.88117028</span><br><span class="line">---&gt; lng: 121.35174316	lat: 30.95681913</span><br><span class="line">---&gt; lng: 121.44733933	lat: 31.07342026</span><br><span class="line">---&gt; lng: 121.52978113	lat: 31.11172273</span><br><span class="line">current record index: <span class="number">2</span></span><br><span class="line">-&gt; current part index: 1</span><br><span class="line">---&gt; lng: 120.98127867	lat: 30.92632927</span><br><span class="line">---&gt; lng: 121.13517934	lat: 30.97933501</span><br><span class="line">---&gt; lng: 121.24920089	lat: 31.10466894</span><br><span class="line">---&gt; lng: 121.31543033	lat: 31.23671254</span><br><span class="line">---&gt; lng: 121.40825932	lat: 31.36832345</span><br></pre></td></tr></table></figure>
<p>但是要构造线段对象，就要麻烦得多。它不能通过简单的列表直接创建，而要先构造所有的转折点组合成数组，再通过点的数组构造成线。</p>
<figure class="highlight python"><figcaption><span>更新线要素的转折点坐标</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> arcpy</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">inputFeature = <span class="string">'gdb/pl'</span></span><br><span class="line">cursor = arcpy.da.UpdateCursor(inputFeature, [<span class="string">'NAME'</span>, <span class="string">'SHAPE@'</span>], spatial_reference=arcpy.SpatialReference(<span class="string">'WGS 1984'</span>))</span><br><span class="line"></span><br><span class="line">pt_list = arcpy.Array()</span><br><span class="line">part_list = arcpy.Array()</span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> cursor:</span><br><span class="line">	<span class="comment"># 会存在多部件的线要素——线要素中的每一条记录不一定只对应一条线</span></span><br><span class="line">	<span class="keyword">for</span> part <span class="keyword">in</span> row[<span class="number">1</span>]:</span><br><span class="line">		<span class="comment"># 对大部分(非绝对)线要素而言, len(part) = 1, 代表此行记录仅一条线, 在人工录入时尤其如此</span></span><br><span class="line">		<span class="keyword">for</span> pnt <span class="keyword">in</span> part:</span><br><span class="line">			pt_list.append(arcpy.Point(pnt.X + random() * <span class="number">0.1</span> - <span class="number">0.05</span>), pnt.Y + random() * <span class="number">0.1</span> - <span class="number">0.05</span>)</span><br><span class="line">			<span class="comment"># 这里的pt_list实际上就是新构建的part, 是Array对象</span></span><br><span class="line">		part_list.append(pt_list)</span><br><span class="line">		<span class="comment"># part_list是一条记录中不同线组成的Array</span></span><br><span class="line">	row[<span class="number">1</span>] = arcpy.Polyline(part_list)</span><br><span class="line">	pt_list.removeAll()</span><br><span class="line">	part_list.removeAll()</span><br><span class="line">	cursor.updateRow(row)</span><br></pre></td></tr></table></figure>
<p>对一条记录包含多条线的要素，仍然能维持以上的数据结构。</p>
<div class="blogPic"><br>    <img src="https://squanblog.oss-cn-hongkong.aliyuncs.com/arcpy_init/line.png?x-oss-process=image/resize,h_440" alt="线要素的几何修改变动对比"><br></div>

<p><span class="pageTitle">3.</span></p>
<p>面是最复杂的要素，不仅仅是因为单条记录中经常出现多个面，也包括孔洞、自交叉等非常的几何关系。其数据结构也有相似的特点。</p>
<div class="blogPic"><br>    <img src="https://squanblog.oss-cn-hongkong.aliyuncs.com/arcpy_init/pg.jpg?x-oss-process=image/resize,h_480" alt="面要素的数据结构示意"><br></div>

<p>第一层，是Array对象，这里是单条记录的不同面部件。</p>
<figure class="highlight python"><figcaption><span>面要素单条记录中的不同部件</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cur = arcpy.da.SearchCursor(<span class="string">r'gdb\pg'</span>, [<span class="string">'NAME'</span>, <span class="string">'SHAPE@'</span>], spatial_reference=arcpy.SpatialReference(<span class="string">'WGS 1984'</span>))</span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> cur:</span><br><span class="line">    <span class="keyword">for</span> part <span class="keyword">in</span> row[<span class="number">1</span>]:</span><br><span class="line">        <span class="keyword">print</span> part</span><br><span class="line"></span><br><span class="line"><span class="comment"># 以下为输出结果</span></span><br><span class="line">&lt;geoprecessing array object object at <span class="number">0x000000</span>&gt;</span><br><span class="line">&lt;geoprecessing array object object at <span class="number">0x000000</span>&gt;</span><br><span class="line">&lt;geoprecessing array object object at <span class="number">0x000000</span>&gt;</span><br></pre></td></tr></table></figure>
<p>第二层已经变成了Point对象，但是从这里要怎么看出部件关系？</p>
<figure class="highlight python"><figcaption><span>解析面要素单条记录中不同面部件的转折点坐标</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">cur = arcpy.da.SearchCursor(<span class="string">r'gdb\pg'</span>, [<span class="string">'NAME'</span>, <span class="string">'SHAPE@'</span>], spatial_reference=arcpy.SpatialReference(<span class="string">'WGS 1984'</span>))</span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> cur:</span><br><span class="line">    <span class="keyword">for</span> part <span class="keyword">in</span> row[<span class="number">1</span>]:</span><br><span class="line">        <span class="keyword">for</span> section <span class="keyword">in</span> part:</span><br><span class="line">            <span class="keyword">print</span> section</span><br><span class="line"></span><br><span class="line"><span class="comment"># 以下为输出结果</span></span><br><span class="line"><span class="number">121.418027</span>  <span class="number">30.853068</span>  NaN  NaN</span><br><span class="line"><span class="number">121.424352</span>  <span class="number">30.964025</span>  NaN  NaN</span><br><span class="line"><span class="number">121.523280</span>  <span class="number">30.974093</span>  NaN  NaN</span><br><span class="line"><span class="number">121.540041</span>  <span class="number">30.853069</span>  NaN  NaN</span><br><span class="line"><span class="number">121.418027</span>  <span class="number">30.853068</span>  NaN  NaN</span><br><span class="line"><span class="number">121.422618</span>  <span class="number">31.155731</span>  NaN  NaN</span><br><span class="line"><span class="number">121.424244</span>  <span class="number">31.071996</span>  NaN  NaN</span><br><span class="line"><span class="number">121.361561</span>  <span class="number">31.019401</span>  NaN  NaN</span><br><span class="line"><span class="number">121.270707</span>  <span class="number">31.032140</span>  NaN  NaN</span><br><span class="line"><span class="number">121.264076</span>  <span class="number">31.108932</span>  NaN  NaN</span><br><span class="line"><span class="number">121.323599</span>  <span class="number">31.179931</span>  NaN  NaN</span><br><span class="line"><span class="number">121.422618</span>  <span class="number">31.155731</span>  NaN  NaN</span><br><span class="line"><span class="keyword">None</span></span><br><span class="line"><span class="number">121.368132</span>  <span class="number">31.071985</span>  NaN  NaN</span><br><span class="line"><span class="number">121.373089</span>  <span class="number">31.127372</span>  NaN  NaN</span><br><span class="line">(...)</span><br></pre></td></tr></table></figure>
<p>仔细看了一下坐标关系，似乎是用了<b>None记录行</b>和坐标记录的<b>顺逆时针顺序</b>来判断孔洞的（顺时针是正常面，逆时针是孔洞），如果是这样的结构，想要做出更新无疑是非常麻烦的事情。</p>
<p>但是不改变转折点数量，单单是改变面要素位置的话，其实问题也不大。只有一层part(之前以为因为孔洞的存在会有两层)的话，其实结构是和线要素一致的。如果想要新增孔洞的话，涉及到位置判断，那个时候就会变得很麻烦。</p>
<figure class="highlight python"><figcaption><span>更新面要素各部件的转折点坐标</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> arcpy</span><br><span class="line"></span><br><span class="line">inputFeature = <span class="string">'gdb/pg'</span></span><br><span class="line">cursor = arcpy.da.UpdateCursor(inputFeature, [<span class="string">'NAME'</span>, <span class="string">'SHAPE@'</span>], spatial_reference=arcpy.SpatialReference(<span class="string">'WGS 1984'</span>))</span><br><span class="line"></span><br><span class="line">hole_list = arcpy.Array()</span><br><span class="line">pt_list = arcpy.Array()</span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> cursor:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'Name: '</span> + row[<span class="number">0</span>]</span><br><span class="line">    <span class="comment"># 会存在多部件的面要素——面要素中的每一条记录不一定只对应一个面</span></span><br><span class="line">    <span class="keyword">for</span> part <span class="keyword">in</span> row[<span class="number">1</span>]:</span><br><span class="line">    	<span class="keyword">if</span> pnt:</span><br><span class="line">    		hole_list.append(arcpy.Point(pnt.X + random() * <span class="number">0.1</span> - <span class="number">0.05</span>, pnt.Y + random() * <span class="number">0.1</span> - <span class="number">0.05</span>))</span><br><span class="line">    	<span class="keyword">else</span>:</span><br><span class="line">    	    <span class="comment"># 出现None记录, 则为孔洞标志</span></span><br><span class="line">    	    <span class="comment"># 需要合并之前的转折点记录, 同时开始记录孔洞</span></span><br><span class="line">    	    <span class="keyword">print</span> <span class="string">'#### hole signature.'</span></span><br><span class="line">    	    hole_list.replace(len(hole_list) - <span class="number">1</span>, hole_list[<span class="number">0</span>])</span><br><span class="line">    	    pt_list.append(hole_list)</span><br><span class="line">    	    hole_list.removeAll()</span><br><span class="line">    	    pt_list.append(pnt)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> pnt == part[<span class="number">-1</span>]:</span><br><span class="line">        	hole_list.replace(len(hole_list) - <span class="number">1</span>, hole_list[<span class="number">0</span>])</span><br><span class="line">        	pt_list.append(hole_list)</span><br><span class="line">    hole_list.removeAll()</span><br><span class="line">    <span class="comment"># 这里的pt_list实际上就是新构建的part, 同时也是Array对象</span></span><br><span class="line">    <span class="comment"># 面要素要求首尾坐标一致(例如四边形会形成5个坐标点)</span></span><br><span class="line">    <span class="comment"># part_list是一条记录中不同面的Array</span></span><br><span class="line">row[<span class="number">1</span>] = arcpy.Polygon(pt_list)</span><br><span class="line">pt_list.removeAll()</span><br><span class="line">cursor.updateRow(row)</span><br></pre></td></tr></table></figure>
<p>孔洞的出现大大增加了算法的复杂程度，也没有专门对应的类，其实是很烦的事情。</p>
<p>另外对面要素的修改很高概率会倒是几何错误，那是另外一个大坑了。几何错误的出现说明在算法上就存在漏洞，不是通过简单的代码层能够解决的事情，更多的需要在算法架构上多做工作。</p>
<div class="blogPic"><br>    <img src="https://squanblog.oss-cn-hongkong.aliyuncs.com/arcpy_init/polygon.png?x-oss-process=image/resize,h_440" alt="面要素的几何修改变动对比"><br></div>

<hr>

<p>写在后面的话。</p>
<p><span class="pageTitle">a.</span></p>
<p>为什么要用arcpy？</p>
<p>因为有些目标很难甚至根本无法通过工具的组合去达成。</p>
<p>简单的例子，要把一个小区边界向东整体平移300m。如果用空间校正，需要计算面节点的坐标，要生成新的配准点文件，要按照新坐标导入位置，不复杂，但是非常麻烦；如果用编辑平移，不可能做到完全精准，再强大的目力，也无法分辨无限细分。</p>
<p>如果能直接把节点坐标加上300m，则问题解决。</p>
<p>所以，arcpy不是作为新的分析方法出现，也不是作为深度的分析工具，它只是辅助工具的辅助工具。像是马克沁的准星，或是手风琴的键帽，并非不可或缺，但确实能解放落后的生产力。</p>
<p><span class="pageTitle">b.</span></p>
<p>arcpy能做些什么？</p>
<p>标准化。</p>
<p>标准化的工作流、标准化的制图规范、标准化的工具模组……把一天甚至一周的工作压缩到一分钟，剩下的都是你的自由时间。一旦尝试过真正的自由，想要再放手就是一件非常艰难的事情了。</p>
<p>自定义。</p>
<p>再也没有许可的束缚、再也没有工具的制约，你面对的不再是重重包裹的要素文件，你看到触摸到的感受到的只有具体数据，不会再有门扉阻隔，整个世界都已经为你开启。心之所向再无战不胜之物。</p>
<p>简洁。</p>
<p>从现在起，丢掉所有的工具，丢掉所有的模型，需要的只有算法和思想。当算法提出之后，只需要一小段文本就能实现。抛开ArcMap吧，它只是一个笨拙的UI界面，你不再需要它了。</p>

  </div>
  <div class="post-footer">
    
      <ul class="post-tag-list"><li class="post-tag-list-item"><a class="post-tag-list-link" href="/tags/GIS/">GIS</a></li><li class="post-tag-list-item"><a class="post-tag-list-link" href="/tags/Python/">Python</a></li></ul>
    

    <a href="#top" class="top">回到顶部</a>
  </div>
</article>

<hr style="margin:0 16px 0 16px;" />
<div id="lv-container" data-id="city" data-uid="MTAyMC8zNjIzOC8xMjc3Mw==" style="margin:0 10px 0 10px;">
  <script type="text/javascript">
 (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];

    if (typeof LivereTower === 'function') { return; }

    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;

    e.parentNode.insertBefore(j, e);
  })(document, 'script');
</script>

</div>

<footer style="text-align:center;">
  &copy; 2018
  <span class="author">
    飛鳥双犬
  </span>
</footer>

    </div>
  </body>
</html>